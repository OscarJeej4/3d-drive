<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>3D Driving Game</title>
<style>
  body, html {
    margin: 0; padding: 0; overflow: hidden; background: #87ceeb;
    touch-action: none; /* prevent default touch gestures */
  }
  #info {
    position: absolute; top: 10px; left: 10px;
    color: white; font-family: monospace; user-select:none;
    background: rgba(0,0,0,0.3); padding: 5px 10px; border-radius: 4px;
  }
  #touchControls {
    position: absolute; bottom: 20px; left: 50%;
    transform: translateX(-50%);
    display: flex; gap: 20px;
  }
  .btn {
    width: 60px; height: 60px; border-radius: 30px;
    background: rgba(0,0,0,0.5); color: white;
    font-size: 24px; line-height: 60px; text-align: center;
    user-select:none;
  }
</style>
</head>
<body>

<div id="info">
  Use WASD or Touch Buttons<br/>
  W - Forward, S - Back, A - Left, D - Right
</div>

<div id="touchControls">
  <div id="leftBtn" class="btn">◀️</div>
  <div id="forwardBtn" class="btn">▲</div>
  <div id="backBtn" class="btn">▼</div>
  <div id="rightBtn" class="btn">▶️</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.min.js"></script>

<script>
  let scene, camera, renderer;
  let car, carSpeed = 0, maxSpeed = 0.3;
  let keys = { forward: false, back: false, left: false, right: false };

  init();
  animate();

  function init() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x87ceeb); // sky blue

    // Camera
    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0, 5, -10);
    camera.lookAt(0, 0, 0);

    // Renderer
    renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Ground
    const groundGeo = new THREE.PlaneGeometry(200, 200);
    const groundMat = new THREE.MeshPhongMaterial({color:0x228B22});
    const ground = new THREE.Mesh(groundGeo, groundMat);
    ground.rotation.x = -Math.PI/2;
    scene.add(ground);

    // Car (simple box)
    const carGeo = new THREE.BoxGeometry(1, 0.5, 2);
    const carMat = new THREE.MeshStandardMaterial({color:0xff0000});
    car = new THREE.Mesh(carGeo, carMat);
    car.position.y = 0.25;
    scene.add(car);

    // Lights
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
    scene.add(ambientLight);

    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
    directionalLight.position.set(5, 10, 7);
    scene.add(directionalLight);

    // Event Listeners
    window.addEventListener('resize', onWindowResize);

    // Keyboard controls
    window.addEventListener('keydown', (e) => {
      if(e.code === "KeyW") keys.forward = true;
      if(e.code === "KeyS") keys.back = true;
      if(e.code === "KeyA") keys.left = true;
      if(e.code === "KeyD") keys.right = true;
    });
    window.addEventListener('keyup', (e) => {
      if(e.code === "KeyW") keys.forward = false;
      if(e.code === "KeyS") keys.back = false;
      if(e.code === "KeyA") keys.left = false;
      if(e.code === "KeyD") keys.right = false;
    });

    // Touch buttons
    const forwardBtn = document.getElementById('forwardBtn');
    const backBtn = document.getElementById('backBtn');
    const leftBtn = document.getElementById('leftBtn');
    const rightBtn = document.getElementById('rightBtn');

    // Helper to add touch events for each button
    function addTouchEvents(button, key) {
      button.addEventListener('touchstart', (e) => {
        e.preventDefault();
        keys[key] = true;
      }, {passive:false});
      button.addEventListener('touchend', (e) => {
        e.preventDefault();
        keys[key] = false;
      }, {passive:false});
      button.addEventListener('touchcancel', (e) => {
        e.preventDefault();
        keys[key] = false;
      }, {passive:false});
    }

    addTouchEvents(forwardBtn, 'forward');
    addTouchEvents(backBtn, 'back');
    addTouchEvents(leftBtn, 'left');
    addTouchEvents(rightBtn, 'right');
  }

  function onWindowResize() {
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  }

  function animate() {
    requestAnimationFrame(animate);

    // Update car movement
    if(keys.forward) {
      carSpeed += 0.01;
      if(carSpeed > maxSpeed) carSpeed = maxSpeed;
    } else if(keys.back) {
      carSpeed -= 0.01;
      if(carSpeed < -maxSpeed/2) carSpeed = -maxSpeed/2;
    } else {
      // Friction slows the car gradually
      carSpeed *= 0.95;
      if(Math.abs(carSpeed) < 0.001) carSpeed = 0;
    }

    if(keys.left) car.rotation.y += 0.03;
    if(keys.right) car.rotation.y -= 0.03;

    // Move car forward
    car.position.x += Math.sin(car.rotation.y) * carSpeed;
    car.position.z += Math.cos(car.rotation.y) * carSpeed;

    // Update camera behind the car
    const relativeCameraOffset = new THREE.Vector3(0, 5, -10);
    const cameraOffset = relativeCameraOffset.applyMatrix4(car.matrixWorld);

    camera.position.lerp(cameraOffset, 0.1);
    camera.lookAt(car.position);

    renderer.render(scene, camera);
  }
</script>

</body>
</html>
